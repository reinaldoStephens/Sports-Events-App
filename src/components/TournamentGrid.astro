---
import PublicTournamentCard from './PublicTournamentCard.astro';
import { supabase } from '../lib/supabase';

interface Props {
  search?: string;
}

const { search = '' } = Astro.props;

let query = supabase
  .from('torneos')
  .select('*')
  .order('fecha_inicio', { ascending: false });

if (search) {
  query = query.ilike('nombre', `%${search}%`);
}

const { data: torneos, error } = await query;

if (error) console.error("Error fetching tournaments:", error);
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
    {torneos && torneos.length > 0 ? torneos.map((torneo) => (
        <PublicTournamentCard tournament={torneo} />
    )) : (
        <div class="col-span-full py-32 text-center bg-slate-50/50 rounded-[3rem] border-4 border-dashed border-slate-100">
            <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mx-auto mb-6 shadow-sm">
                <svg class="h-10 w-10 text-slate-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 9.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="text-2xl font-black text-slate-400 uppercase tracking-tighter">No se encontraron torneos</h3>
            <p class="text-slate-400 font-medium mt-2">Prueba ajustando tu búsqueda o vuelve más tarde.</p>
        </div>
    )}
</div>
